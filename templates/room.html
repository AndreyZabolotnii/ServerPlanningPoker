<!doctype html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="templates/css/main.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;0,800;1,300;1,400;1,600;1,700;1,800&display=swap"
        rel="stylesheet">
    <title>Sign In</title>
</head>

<body>
    <header>
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">

                    <nav class="navbar navbar-expand-lg navbar-light bg-light">
                        <a class="navbar-brand" href="#">
                            <img src="../templates/img/icon.png" width="30" height="30" alt="">
                        </a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>

                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav mr-auto">
                                <li class="nav-item active">
                                    <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Link</a>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Dropdown
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                        <a class="dropdown-item" href="#">Action</a>
                                        <a class="dropdown-item" href="#">Another action</a>
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item" href="#">Something else here</a>
                                    </div>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link disabled" href="#">Disabled</a>
                                </li>
                            </ul>
                            <form class="form-inline">
                                <button id="signUp" class="btn btn-outline-success" type="button">Sign Up</button>
                            </form>
                        </div>
                    </nav>

                </div>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12 text-center name-meeting">
                <h1></h1>
            </div>
            <div class="col-lg-3 text-center left-menu-room">
                <div class="task-room">1. Add new banner on site</div>
                <div class="task-room">2. Delete db that is not used </div>
                <div class="task-room">3. Lanfing page makking</div>
                <div class="task-room">4. Planning poker to finish</div>
                <div class="task-room">5. To make a nice dinner</div>
            </div>
            <div class="col-lg-7 text-center main-room">
                <button class="button-room">0.5</button>
                <button class="button-room">1</button>
                <button class="button-room">3</button>
                <button class="button-room">5</button>
                <button class="button-room">10</button>
            </div>
            <div class="col-lg-2 text-center right-menu-room">
                <h3 class="text-center">Party:</h3>
                <ul>
                    
                </ul>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-lg-12">




            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.1/knockout-latest.js" integrity="sha512-2AL/VEauKkZqQU9BHgnv48OhXcJPx9vdzxN1JrKDVc4FPU/MEE/BZ6d9l0mP7VmvLsjtYwqiYQpDskK9dG8KBA==" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"
        integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>

    <script type="text/javascript">
        let socketInst, currentXmlString, currentXml

        currentXmlString = `<room>
    <persons>
        <person id="1" name="Roman"></person>
        <person id="2" name="Andrew"></person>
        <person id="3" name="Elena"></person>
        <person id="4" name="Max"></person>
    </persons>
    
    <meeting name="Meeting 01">
        <task id="1" name="Task 01" currentActive="false">
            <person id="1" vote="true" score="3">
            <person id="2" vote="true" score="3">
            <person id="3" vote="true" score="3">
            <person id="4" vote="true" score="3">
        </task>
        <task id="2" name="Task 02" currentActive="true">
            <person id="1" vote="false" score="0">
            <person id="2" vote="false" score="0">
            <person id="3" vote="false" score="0">
            <person id="4" vote="false" score="0">
        </task>
        <task id="3" name="Task 03" currentActive="false">
            <person id="1" vote="false" score="0">
            <person id="2" vote="false" score="0">
            <person id="3" vote="false" score="0">
            <person id="4" vote="false" score="0">
        </task>       
    </meeting>
</room>` //test

        $.extend({
            getUrlVars: function () {
                var vars = [], hash;
                var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
                for (var i = 0; i < hashes.length; i++) {
                    hash = hashes[i].split('=');
                    vars.push(hash[0]);
                    vars[hash[0]] = hash[1];
                }
                return vars;
            },
            getUrlVar: function (name) {
                return $.getUrlVars()[name];
            }
        });

        function createWebSocket(queryParam) {
            socketInst = new WebSocket('ws://localhost:80/echo?roomId=' + $.getUrlVar('roomId'));
            socketInst.onopen = function (event) {


            }
            socketInst.onmessage = function (event) {
                currentXmlString = event.data;
                parseXmlResponse(currentXml);
            }
        }
        
        function parseXmlResponse(currentXml){
            var parserXml = new DOMParser();
            currentXml = parserXml.parseFromString(currentXmlString, "text/xml");
            var persons = currentXml.getElementsByTagName('persons')[0].getElementsByTagName('person')
            if (persons != null && persons != undefined)
            for (var i = 0; i < persons.length; i++) {
                $(`<li>${persons[i].getAttribute('name')}</li>`).appendTo($('.right-menu-room ul'));
            }
            var nameMeeting = currentXml.getElementsByTagName('meeting')[0].getAttribute('name');
            if (nameMeeting != null & persons != undefined){
                console.log(nameMeeting)
                $('.name-meeting h1').text(nameMeeting);
            }
            var tasks = currentXml.getElementsByTagName('meeting')[0].getElementsByTagName('task');
            if (tasks != null && tasks != undefined) {
                for (var i = 0; i < tasks.length; i++) {
                    $(`<li>${tasks[i].getAttribute('name')}</li>`).appendTo($('.right-menu-room ul'));
                }
            }
            console.log(persons);
        }

        $('#red').click(() => {
            socketInst.send($("input[name='roomId']").val())
        });
        $('#blue').click(() => {
            SendColor('blue')
        });
        $('#yellow').click(() => {
            SendColor('yellow')
        });
        $('#green').click(() => {
            SendColor('green')
        });

        var roomId = $("input[name='roomId']").val()
        createWebSocket(roomId);


        parseXmlResponse(currentXml); //test
    </script>


</body>

</html>
